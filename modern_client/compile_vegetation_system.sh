#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Modern Lineage II

VEGETATION_CPP_FILE="vegetation_system_game.cpp"
EXECUTABLE_NAME="ModernLineage2_VegetationSystem"
LOG_FILE="/tmp/vegetation_system_game.log"
PID_FILE="/tmp/vegetation_system_game.pid"

echo "üå≥ –ö–æ–º–ø–∏–ª—è—Ü–∏—è Modern Lineage II Vegetation System Client..."
echo "üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:"
echo "   ‚úÖ 10 —Ç–∏–ø–æ–≤ –¥–µ—Ä–µ–≤—å–µ–≤ –∏–∑ L2 –¥–µ–æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞"
echo "   ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Ç—Ä–∞–≤–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –≤–µ—Ç—Ä–∞"
echo "   ‚úÖ –ö—Ä–∞—Å–æ—á–Ω—ã–µ —Ü–≤–µ—Ç—ã —Å –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ–º"
echo "   ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã—Å–æ—Ç—ã —Ä–µ–ª—å–µ—Ñ–∞"
echo "   ‚úÖ –ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
if [ ! -f "$VEGETATION_CPP_FILE" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª $VEGETATION_CPP_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

echo "üî® –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è C++ —Ñ–∞–π–ª–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º g++
g++ "$VEGETATION_CPP_FILE" -o "$EXECUTABLE_NAME" -lGL -lGLU -lglut -lm

if [ $? -eq 0 ]; then
    echo "‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ó–∞–ø—É—Å–∫–∞—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    if [ -f "$PID_FILE" ]; then
        OLD_PID=$(cat "$PID_FILE")
        if ps -p "$OLD_PID" > /dev/null 2>&1; then
            echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (PID: $OLD_PID)..."
            kill "$OLD_PID" 2>/dev/null
            sleep 1
        fi
        rm -f "$PID_FILE"
    fi
    
    # –ó–∞–ø—É—Å–∫ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–≥—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    echo "üöÄ –ó–∞–ø—É—Å–∫ Modern Lineage II Vegetation System Client..."
    nohup "./$EXECUTABLE_NAME" > "$LOG_FILE" 2>&1 &
    GAME_PID=$!
    echo "$GAME_PID" > "$PID_FILE"
    
    echo ""
    echo "üå≥ ===== MODERN LINEAGE II VEGETATION SYSTEM –ó–ê–ü–£–©–ï–ù! ====="
    echo ""
    echo "üéÆ PID: $GAME_PID"
    echo "üìù –õ–æ–≥–∏: $LOG_FILE"
    echo ""
    echo "üå≤ –°–ò–°–¢–ï–ú–ê –†–ê–°–¢–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"
    echo "   üå≥ 200 –¥–µ—Ä–µ–≤—å–µ–≤ 10 —Ç–∏–ø–æ–≤ –∏–∑ L2 –∫–ª–∏–µ–Ω—Ç–∞"
    echo "   üå± 1000 —Ç—Ä–∞–≤–∏–Ω–æ–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –≤–µ—Ç—Ä–∞"
    echo "   üå∏ 500 —Ü–≤–µ—Ç–æ–≤ 5 —Ç–∏–ø–æ–≤ —Å –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ–º"
    echo "   üé® –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫"
    echo "   üí® –í–µ—Ç—Ä–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –≤—Å—é —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
    echo ""
    echo "üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:"
    echo "   WASD     - –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ –º–∏—Ä—É"
    echo "   –°—Ç—Ä–µ–ª–∫–∏  - –ü–æ–≤–æ—Ä–æ—Ç –∫–∞–º–µ—Ä—ã"
    echo "   T        - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ü–∏–∫–ª –¥–µ–Ω—å/–Ω–æ—á—å"
    echo "   R        - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –¥–æ–∂–¥—å –∏ –≤–µ—Ç–µ—Ä"
    echo "   –õ–ö–ú      - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ"
    echo "   ESC      - –í—ã—Ö–æ–¥"
    echo ""
    echo "üå≥ –¢–ò–ü–´ –î–ï–†–ï–í–¨–ï–í L2:"
    echo "   üå≤ Aden Tree - –¥–µ—Ä–µ–≤—å—è –ê–¥–µ–Ω–∞"
    echo "   üå≤ Dion Tree - –¥–µ—Ä–µ–≤—å—è –î–∏–æ–Ω–∞"
    echo "   üå≤ Gludio Tree - –¥–µ—Ä–µ–≤—å—è –ì–ª—É–¥–∏–æ"
    echo "   üå≤ Godad Tree - –¥–µ—Ä–µ–≤—å—è –ì–æ–¥–∞–¥–∞"
    echo "   üå≤ Innadrill Tree - –¥–µ—Ä–µ–≤—å—è –ò–Ω–Ω–∞–¥—Ä–∏–ª–∞"
    echo "   üå≤ Oren Tree - –¥–µ—Ä–µ–≤—å—è –û—Ä–µ–Ω–∞"
    echo "   üå≤ Primitive Tree - –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –¥–µ—Ä–µ–≤—å—è"
    echo "   üå≤ Rionsctgart Tree - –¥–µ—Ä–µ–≤—å—è –†–∏–æ–Ω—Å—Ü—Ç–≥–∞—Ä—Ç–∞"
    echo "   üå≤ Rune Tree - —Ä—É–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ä–µ–≤—å—è"
    echo "   üå≤ Speaking Tree - –≥–æ–≤–æ—Ä—è—â–∏–µ –¥–µ—Ä–µ–≤—å—è"
    echo ""
    echo "üå± –≠–§–§–ï–ö–¢–´ –†–ê–°–¢–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"
    echo "   üåÖ –¶–≤–µ—Ç–∞ –º–µ–Ω—è—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫"
    echo "   üí® –ü–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç –≤–µ—Ç—Ä–∞ —Å —Ä–∞–∑–Ω–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é"
    echo "   üåßÔ∏è  –£—Å–∏–ª–µ–Ω–Ω–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –¥–æ–∂–¥—è"
    echo "   üé® –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–≤–µ—Ç–∞ (–∑–µ–ª–µ–Ω—ã–π –¥–Ω–µ–º, —Ç–µ–º–Ω—ã–π –Ω–æ—á—å—é)"
    echo "   üå∏ –†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–µ —Ü–≤–µ—Ç—ã (–∫—Ä–∞—Å–Ω—ã–π, –∂–µ–ª—Ç—ã–π, —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, –∑–µ–ª–µ–Ω—ã–π, —Å–∏–Ω–∏–π)"
    echo ""
    echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: kill $GAME_PID –∏–ª–∏ pkill -f $EXECUTABLE_NAME"
    echo "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: tail -f $LOG_FILE"
    echo ""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —á—Ç–æ –∏–≥—Ä–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å
    sleep 3
    if ps -p "$GAME_PID" > /dev/null 2>&1; then
        echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
        echo "üå≥ –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∂–∏–≤–æ–π –ø—Ä–∏—Ä–æ–¥–æ–π —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π!"
        echo "üéØ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å R –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –¥–æ–∂–¥—è –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤—å–µ–≤!"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: $LOG_FILE"
        if [ -f "$LOG_FILE" ]; then
            echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞:"
            tail -10 "$LOG_FILE"
        fi
    fi
    
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏!"
    echo "üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã: freeglut3-dev libglut-dev"
    echo "üí° –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏: sudo apt-get install freeglut3-dev libglut-dev"
    exit 1
fi

