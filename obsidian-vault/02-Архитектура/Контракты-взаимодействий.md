# ü§ù –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–æ–≤

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç sequence –¥–∏–∞–≥—Ä–∞–º–º—ã, –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—â–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–æ–≤ L2J.

## üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant Client as –ö–ª–∏–µ–Ω—Ç
    participant BotManager as BotManager
    participant BotFactory as BotFactory
    participant BotContext as BotContext
    participant EnhancedFakePlayer as EnhancedFakePlayer
    participant EventManager as EventManager
    participant AIManager as AIManager

    Client->>BotManager: createBot(botType)
    BotManager->>BotFactory: createBot(botType)
    
    BotFactory->>BotContext: new BotContext(botId)
    BotContext-->>BotFactory: context
    
    BotFactory->>BotFactory: createBotContext(botId, botType)
    BotFactory->>BotContext: setData("botType", botType)
    BotFactory->>BotContext: setData("level", 1)
    BotFactory->>BotContext: setData("maxHp", 100)
    
    BotFactory->>EnhancedFakePlayer: new EnhancedFakePlayer(context, botType)
    EnhancedFakePlayer-->>BotFactory: bot
    
    BotFactory->>AIManager: configureAISystem(bot, context)
    AIManager->>BotContext: setData("aiComponents", components)
    
    BotFactory->>BotFactory: configureBotTypeSpecific(botType, context)
    BotFactory->>BotContext: setData("targetLevel", 20)
    BotFactory->>BotContext: setData("targetKills", 100)
    
    BotFactory->>EnhancedFakePlayer: start()
    EnhancedFakePlayer->>EnhancedFakePlayer: active.set(true)
    EnhancedFakePlayer->>BotContext: setState(BotState.IDLE)
    
    BotFactory->>EventManager: publish(BotCreatedEvent)
    EventManager->>EventManager: processEvent(event)
    
    BotFactory-->>BotManager: bot
    BotManager->>BotManager: addBot(bot)
    BotManager-->>Client: bot
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant Client as –ö–ª–∏–µ–Ω—Ç
    participant BotManager as BotManager
    participant BotFactory as BotFactory
    participant BotContext as BotContext
    participant EventManager as EventManager

    Client->>BotManager: createBot(botType)
    BotManager->>BotFactory: createBot(botType)
    
    BotFactory->>BotContext: new BotContext(botId)
    BotContext-->>BotFactory: context
    
    BotFactory->>BotContext: setData("botType", botType)
    Note over BotContext: NullPointerException
    
    BotContext->>BotContext: synchronized initialization
    BotContext-->>BotFactory: success
    
    BotFactory->>EventManager: publish(BotCreatedEvent)
    EventManager->>EventManager: processEvent(event)
    
    BotFactory-->>BotManager: bot
    BotManager-->>Client: bot
```

## üéØ AI —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

### –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –±–æ—Ç–æ–º

```mermaid
sequenceDiagram
    participant Bot as EnhancedFakePlayer
    participant AIManager as AIManager
    participant GoalPlanner as GoalPlanner
    participant ActionPlanner as ActionPlanner
    participant BehaviorSelector as BehaviorSelector
    participant BehaviorManager as BehaviorManager
    participant ActionManager as ActionManager

    Bot->>AIManager: makeDecision()
    
    AIManager->>GoalPlanner: createGoalPlan(bot)
    GoalPlanner->>GoalPlanner: analyzeCurrentState()
    GoalPlanner->>GoalPlanner: prioritizeGoals()
    GoalPlanner-->>AIManager: goals
    
    AIManager->>BehaviorSelector: selectBehavior(bot, availableBehaviors)
    BehaviorSelector->>BehaviorManager: getAllBehaviors()
    BehaviorManager-->>BehaviorSelector: behaviors
    BehaviorSelector->>BehaviorSelector: evaluateStrategies()
    BehaviorSelector-->>AIManager: selectedBehavior
    
    AIManager->>ActionPlanner: createActionPlan(bot, goal)
    ActionPlanner->>ActionPlanner: planActions(goal)
    ActionPlanner-->>AIManager: actionPlan
    
    AIManager->>ActionManager: executeAction(action)
    ActionManager->>ActionManager: validateAction(action)
    ActionManager->>Bot: performAction(action)
    Bot->>Bot: executeAction(action)
    
    ActionManager-->>AIManager: result
    AIManager-->>Bot: decisionResult
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant Bot as EnhancedFakePlayer
    participant BehaviorSelector as BehaviorSelector
    participant CurrentBehavior as –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    participant NewBehavior as –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    participant EventManager as EventManager

    Bot->>BehaviorSelector: switchBehavior()
    
    BehaviorSelector->>CurrentBehavior: onEnd(botContext)
    CurrentBehavior->>CurrentBehavior: cleanup()
    CurrentBehavior-->>BehaviorSelector: completed
    
    BehaviorSelector->>BehaviorSelector: selectNewBehavior()
    BehaviorSelector-->>Bot: newBehavior
    
    Bot->>NewBehavior: onStart(botContext)
    NewBehavior->>NewBehavior: initialize()
    NewBehavior-->>Bot: ready
    
    Bot->>EventManager: publish(BehaviorChangedEvent)
    EventManager->>EventManager: processEvent(event)
    
    Bot->>Bot: updateBehavior(newBehavior)
```

## üì° –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

```mermaid
sequenceDiagram
    participant Publisher as –ò–∑–¥–∞—Ç–µ–ª—å
    participant EventManager as EventManager
    participant Listener1 as –°–ª—É—à–∞—Ç–µ–ª—å 1
    participant Listener2 as –°–ª—É—à–∞—Ç–µ–ª—å 2
    participant ExecutorService as ExecutorService

    Publisher->>EventManager: publish(event)
    EventManager->>EventManager: validateEvent(event)
    
    EventManager->>ExecutorService: submit(eventProcessor)
    ExecutorService->>EventManager: processEvent(event)
    
    EventManager->>Listener1: onEvent(event)
    Listener1->>Listener1: handleEvent(event)
    Listener1-->>EventManager: processed
    
    EventManager->>Listener2: onEvent(event)
    Listener2->>Listener2: handleEvent(event)
    Listener2-->>EventManager: processed
    
    EventManager->>EventManager: updateMetrics()
    EventManager-->>Publisher: eventProcessed
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è

```mermaid
sequenceDiagram
    participant Listener as –°–ª—É—à–∞—Ç–µ–ª—å
    participant EventManager as EventManager
    participant EventType as EventType
    participant SubscriptionMap as SubscriptionMap

    Listener->>EventManager: subscribe(eventType, listener)
    EventManager->>EventType: validateEventType(eventType)
    EventType-->>EventManager: valid
    
    EventManager->>SubscriptionMap: addSubscription(eventType, listener)
    SubscriptionMap->>SubscriptionMap: storeSubscription()
    SubscriptionMap-->>EventManager: stored
    
    EventManager->>EventManager: updateListenerCount()
    EventManager-->>Listener: subscribed
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–æ—Ç–∞

### –ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant BotManager as BotManager
    participant BotFactory as BotFactory
    participant Bot as EnhancedFakePlayer
    participant EventManager as EventManager
    participant AIManager as AIManager
    participant ActionManager as ActionManager

    BotManager->>BotFactory: createBot(botType)
    BotFactory->>Bot: new EnhancedFakePlayer()
    Bot-->>BotFactory: bot
    BotFactory->>Bot: start()
    Bot->>Bot: active.set(true)
    Bot->>EventManager: publish(BotCreatedEvent)
    
    loop –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã
        Bot->>AIManager: makeDecision()
        AIManager->>ActionManager: executeAction()
        ActionManager->>Bot: performAction()
        Bot->>Bot: updateState()
    end
    
    BotManager->>Bot: stop()
    Bot->>Bot: active.set(false)
    Bot->>EventManager: publish(BotStoppedEvent)
    
    BotManager->>BotManager: removeBot(botId)
    BotManager->>EventManager: publish(BotRemovedEvent)
```

## üéÆ –ò–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

```mermaid
sequenceDiagram
    participant Bot as EnhancedFakePlayer
    participant ActionManager as ActionManager
    participant MoveAction as MoveAction
    participant AttackAction as AttackAction
    participant LootAction as LootAction
    participant GameServer as L2J GameServer

    Bot->>ActionManager: executeAction(actionType)
    ActionManager->>ActionManager: validateAction(actionType)
    
    alt –î–≤–∏–∂–µ–Ω–∏–µ
        ActionManager->>MoveAction: execute(bot)
        MoveAction->>Bot: getCurrentPosition()
        Bot-->>MoveAction: position
        MoveAction->>GameServer: moveTo(targetPosition)
        GameServer-->>MoveAction: success
        MoveAction-->>ActionManager: completed
    else –ê—Ç–∞–∫–∞
        ActionManager->>AttackAction: execute(bot)
        AttackAction->>Bot: getTarget()
        Bot-->>AttackAction: target
        AttackAction->>GameServer: attack(target)
        GameServer-->>AttackAction: success
        AttackAction-->>ActionManager: completed
    else –õ—É—Ç
        ActionManager->>LootAction: execute(bot)
        LootAction->>Bot: getLootableItems()
        Bot-->>LootAction: items
        LootAction->>GameServer: loot(items)
        GameServer-->>LootAction: success
        LootAction-->>ActionManager: completed
    end
    
    ActionManager->>Bot: updateState()
    ActionManager-->>Bot: actionCompleted
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º—ã

```mermaid
sequenceDiagram
    participant MetricsCollector as MetricsCollector
    participant BotManager as BotManager
    participant EventManager as EventManager
    participant AIManager as AIManager
    participant CacheManager as CacheManager
    participant MemoryMXBean as MemoryMXBean
    participant ThreadMXBean as ThreadMXBean

    MetricsCollector->>BotManager: getActiveBotCount()
    BotManager-->>MetricsCollector: activeCount
    
    MetricsCollector->>BotManager: getTotalBotsCreated()
    BotManager-->>MetricsCollector: totalCreated
    
    MetricsCollector->>EventManager: getTotalEventsProcessed()
    EventManager-->>MetricsCollector: totalEvents
    
    MetricsCollector->>CacheManager: size()
    CacheManager-->>MetricsCollector: cacheSize
    
    MetricsCollector->>MemoryMXBean: getHeapMemoryUsage()
    MemoryMXBean-->>MetricsCollector: memoryUsage
    
    MetricsCollector->>ThreadMXBean: getThreadCount()
    ThreadMXBean-->>MetricsCollector: threadCount
    
    MetricsCollector->>MetricsCollector: logMetrics()
    MetricsCollector->>MetricsCollector: updateDashboard()
```

## üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ

```mermaid
sequenceDiagram
    participant Component as –ö–æ–º–ø–æ–Ω–µ–Ω—Ç
    participant ErrorHandler as ErrorHandler
    participant Logger as Logger
    participant EventManager as EventManager
    participant BotManager as BotManager

    Component->>Component: performOperation()
    Note over Component: Exception occurs
    
    Component->>ErrorHandler: handleException(exception)
    ErrorHandler->>Logger: logError(exception)
    Logger->>Logger: writeToLog()
    
    ErrorHandler->>EventManager: publish(ErrorEvent)
    EventManager->>EventManager: processEvent()
    
    alt –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
        ErrorHandler->>BotManager: stopAllBots()
        BotManager->>BotManager: emergencyShutdown()
    else –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–∞—è –æ—à–∏–±–∫–∞
        ErrorHandler->>Component: retryOperation()
        Component->>Component: retry()
    end
    
    ErrorHandler-->>Component: handled
```

## üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç Farmer –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant FarmerBot as Farmer Bot
    participant GoalPlanner as GoalPlanner
    participant ActionPlanner as ActionPlanner
    participant MoveAction as MoveAction
    participant AttackAction as AttackAction
    participant LootAction as LootAction

    FarmerBot->>GoalPlanner: createGoalPlan()
    GoalPlanner->>GoalPlanner: prioritizeGoals()
    Note over GoalPlanner: 1. FarmAdena (80)<br/>2. Survive (100)<br/>3. CompleteQuests (70)
    
    GoalPlanner-->>FarmerBot: goals
    
    FarmerBot->>ActionPlanner: createActionPlan(goal)
    ActionPlanner->>ActionPlanner: planFarmingActions()
    Note over ActionPlanner: 1. Search (70)<br/>2. MoveToTarget (60)<br/>3. Attack (50)<br/>4. Loot (40)
    
    ActionPlanner-->>FarmerBot: actionPlan
    
    FarmerBot->>MoveAction: execute()
    MoveAction-->>FarmerBot: completed
    
    FarmerBot->>AttackAction: execute()
    AttackAction-->>FarmerBot: completed
    
    FarmerBot->>LootAction: execute()
    LootAction-->>FarmerBot: completed
```

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç Quester –±–æ—Ç–∞

```mermaid
sequenceDiagram
    participant QuesterBot as Quester Bot
    participant GoalPlanner as GoalPlanner
    participant ActionPlanner as ActionPlanner
    participant SearchAction as SearchAction
    participant TalkToNPCAction as TalkToNPCAction
    participant InteractAction as InteractAction

    QuesterBot->>GoalPlanner: createGoalPlan()
    GoalPlanner->>GoalPlanner: prioritizeGoals()
    Note over GoalPlanner: 1. CompleteQuests (70)<br/>2. Survive (100)<br/>3. FarmAdena (80)
    
    GoalPlanner-->>QuesterBot: goals
    
    QuesterBot->>ActionPlanner: createActionPlan(goal)
    ActionPlanner->>ActionPlanner: planQuestingActions()
    Note over ActionPlanner: 1. Search (70)<br/>2. MoveToTarget (60)<br/>3. TalkToNPC (50)<br/>4. Interact (45)
    
    ActionPlanner-->>QuesterBot: actionPlan
    
    QuesterBot->>SearchAction: execute()
    SearchAction-->>QuesterBot: completed
    
    QuesterBot->>TalkToNPCAction: execute()
    TalkToNPCAction-->>QuesterBot: completed
    
    QuesterBot->>InteractAction: execute()
    InteractAction-->>QuesterBot: completed
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –£—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:
- **–°–ø–ª–æ—à–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞** ‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤
- **–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞** - - - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤
- **Note** üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **Alt** üîÄ –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- **Loop** üîÑ –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –æ—à–∏–±–∫–∏
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - —Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
5. **–ú–µ—Ç—Ä–∏–∫–∏** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤:
- –ù–æ–≤—ã–µ —Ç–∏–ø—ã –±–æ—Ç–æ–≤ –¥–æ–±–∞–≤–ª—è—é—Ç —Å–≤–æ–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
- –ù–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞—Å—à–∏—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

